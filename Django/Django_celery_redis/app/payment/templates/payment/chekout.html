{% include "base.html" %} {% load static %} {% block content %}

<style>
  body {
    background-color: gray;
  }
</style>

<body>
  <br />

  <div
    class="container bg-white shadow-md p-5"
    style="width: 500px; border-radius: 20px"
  >
    <form id="form" method="POST" action="{% url "payment:complete-order" %}">
      <div>
        <h3>
          <i class="fa fa-chevron-circle-right" aria-hidden="true"></i> &nbsp;
          Complete your order
        </h3>

        <p>Please enter in the relevant information below.</p>

        <hr />

        <br />

        <div class="form-field">
          <input
            class="form-control validate"
            id="name"
            name="name"
            type="text"
            placeholder="Full name*"
            autocomplete="off"
            value="{{shipping_address.full_name}}"
            required
          />
        </div>

        <br />

        <div class="form-field">
          <input
            class="form-control validate"
            id="email"
            type="email"
            placeholder="Email address*"
            autocomplete="off"
            value="{{shipping_address.email}}"
            required
          />
        </div>

        <br />

        <div class="form-field">
          <input
            class="form-control validate"
            id="address1"
            name="address1"
            type="text"
            placeholder="Street address*"
            autocomplete="off"
            value="{{shipping_address.street_adress}}"
            required
          />
        </div>

        <br />

        <div class="form-field">
          <input
            class="form-control validate"
            id="address2"
            name="address2"
            type="text"
            placeholder="Apartment address"
            autocomplete="off"
            value="{{shipping_address.apartment_adress}}"
            required
          />
        </div>

        <br />

        
        <div class="form-field">
          <input
            class="form-control validate"
            id="city"
            name="city"
            type="text"
            placeholder="City*"
            autocomplete="off"
            value="{{shipping_address.city}}"
            required
          />
        </div>
        

        <br />

        <div class="form-field">
          <input
            class="form-control"
            id="country"
            name="country"
            type="text"
            placeholder="Country"
            autocomplete="off"
            value="{{shipping_address.country}}"
          />
        </div>

        <br />

        <div class="form-field">
          <input
            class="form-control"
            id="zipcode"
            name="zipcode"
            type="text"
            placeholder="Zip code (Optional)"
            autocomplete="off"
            value="{{shipping_address.zip}}"
          />
        </div>
      </div>

      <br />
      {% csrf_token %}

      <button
        id="complete-order-stripe"
        type="submit"
        class="btn btn-primary navbar-btn text-white"
        name="stripe-payment"
        value="stripe-payment"
      >
        &nbsp; Pay with Stripe
      </button>
      <button
        id="complete-order-yookassa"
        type="submit"
        class="btn btn-primary navbar-btn text-white"
        name="yookassa-payment"
        value="yookassa-payment"
      >
        &nbsp; Pay with YooKassa
      </button>

      <br />
    </form>
    <button
        id="complpe"
        type="button"
        class="btn btn-primary navbar-btn text-white"
        name="pay"
        value="sment"
      >
        &nbsp; PStripe
      </button>
  </div>

  <br />
</body>
<script>
  $(document).on('click', '#complpe', function (e) {
      e.preventDefault();

      $.ajax({
          type: 'POST',
          url: '{% url "payment:complete-order" %}',
          data: {
              name: $('#name').val(),
              email: $('#email').val(),
              street_address: $('#address1').val(),
              apartment_address: $('#address2').val(),
              country: $('#country').val(),
              zipcode: $('#zipcode').val(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
              action: 'payment'
          },
          success: function (response) {
              window.location.href = "{% url 'payment:payment_success' %}";
          },
          error: function (error) {
              window.location.href = "{% url 'payment:payment_fail' %}";
              console.log(error);
          }
      });
  });

  // Убедитесь, что CSRF токен передаётся для всех AJAX-запросов
  $.ajaxSetup({
      headers: {
          'X-CSRFToken': '{{ csrf_token }}'
      }
  });
</script>


{% endblock %}
